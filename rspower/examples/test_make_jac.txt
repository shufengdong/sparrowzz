#include ../data/case14.txt
#include ../lib/idx_gen.txt
#include ../lib/idx_bus.txt
#include ../lib/idx_brch.txt
#include ../lib/make_y_bus.txt
#include ../lib/dSbus_dV.txt
#include ../lib/make_jac.txt
#include ../lib/bustypes.txt

// 可以同时测试dSbus_dV的计算

jac = make_jac(baseMVA, bus, branch, gen, 1);

assert_relative_eq(jac, [
    [22.0183, -17.3238, 0, 0, -4.6945, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8.5785, -3.8746, 0, 0, -0.3895, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [-16.3624, 32.7603, -5.1624, -5.5913, -5.6442, 0, 0, 0, 0, 0, 0, 0, 0, 0, -6.5890, 10.1258, -0.5023, -1.2558, -1.4141, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, -4.8397, 9.9667, -5.1270, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.7864, 2.2188, -2.2176, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, -5.2565, -5.2975, 40.0558, -22.2278, 0, -5.2839, 0, -1.9902, 0, 0, 0, 0, 0, 0, -2.1966, -1.8066, 10.2444, -7.5632, 0, 0.2642, 0, 0.1520, 0, 0, 0, 0, 0],
    [-4.3559, -5.4039, 0, -22.6124, 36.9978, -4.6256, 0, 0, 0, 0, 0, 0, 0, 0, -1.6935, -2.0825, 0, -6.3799, 9.6836, 0.4117, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, -4.6256, 19.80076, 0, 0, 0, 0, -4.6521, -3.6103, -6.9126, 0, 0, 0, 0, 0, -0.4319, 6.9377, 0, 0, 0, 0, -2.0482, -1.5822, -3.20828, 0],
    [0, 0, 0, -5.2839, 0, 0, 22.0459, -6.5716, -10.1904, 0, 0, 0, 0, 0, 0, 0, 0, -0.2754, 0, 0, -0.002314, -0.00105, 0.26450, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, -6.57156, 6.5716, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.00108, 0.00105, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, -1.9902, 0, 0, -10.1904, 0, 27.0399, -11.5161, 0, 0, 0, -3.3431, 0, 0, 0, -0.1575, 0, 0, -0.2630, 0, 5.3468, -4.0900, 0, 0, 0, -1.4421],
    [0, 0, 0, 0, 0, 0, 0, 0, -11.4920, 16.3718, -4.8799, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -4.13146, 5.9914, -2.0018, 0, 0, 0],
    [0, 0, 0, 0, 0, -4.6081, 0, 0, 0, -4.9025, 9.5106, 0, 0, 0, 0, 0, 0, 0, 0, -2.1094, 0, 0, 0, -1.9629, 4.0220, 0, 0, 0],
    [0, 0, 0, 0, 0, -3.5592, 0, 0, 0, 0, 0, 6.0582, -2.49895, 0, 0, 0, 0, 0, 0, -1.6594, 0, 0, 0, 0, 0, 4.1789, -2.6222, 0],
    [0, 0, 0, 0, 0, -6.7984, 0, 0, 0, 0, 0, -2.4903, 11.8256, -2.5369, 0, 0, 0, 0, 0, -3.3586, 0, 0, 0, 0, 0, -2.6172, 6.9293, -1.1564],
    [0, 0, 0, 0, 0, 0, 0, 0, -3.2833, 0, 0, 0, -2.4989, 5.7822, 0, 0, 0, 0, 0, 0, 0, 0, -1.5352, 0, 0, 0, -1.2146, 2.5105],
    [-4.4463, 4.04898, 0, 0, 0.3973, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20.4558, -16.5778, 0, 0, -4.6025, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [6.9843, -10.2136, 0.5073, 1.2796, 1.4424, 0, 0, 0, 0, 0, 0, 0, 0, 0, -15.4362, 31.9192, -5.1113, -5.4870, -5.5335, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1.8668, -4.1265, 2.2597, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -4.6313, 9.9732, -5.0314, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 2.2955, 1.8246, -11.3935, 7.7144, 0, -0.2806, 0, -0.1605, 0, 0, 0, 0, 0, 0, -5.0301, -5.2450, 39.4683, -21.7919, 0, -4.9754, 0, -1.8846, 0, 0, 0, 0, 0],
    [1.7951, 2.1762, 0, 6.5011, -10.0319, -0.4405, 0, 0, 0, 0, 0, 0, 0, 0, -4.1093, -5.1712, 0, -22.1908, 36.2162, -4.3230, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0.4405, -7.6434, 0, 0, 0, 0, 2.1649, 1.6692, 3.3687, 0, 0, 0, 0, 0, -4.5349, 18.6038, 0, 0, 0, 0, -4.4013, -3.4221, -6.5835, 0],
    [0, 0, 0, 0.2806, 0, 0, -0.002457, 0.001147, -0.2793, 0, 0, 0, 0, 0, 0, 0, 0, -5.1854, 0, 0, 20.7633, -6.0290, -9.6500, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, -0.001147, 0.001147, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -6.1879, 6.3469, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0.1605, 0, 0, 0.2793, 0, -6.2323, 4.2986, 0, 0, 0, 1.4940, 0, 0, 0, -1.9531, 0, 0, -9.5955, 0, 25.2774, -10.9573, 0, 0, 0, -3.2270],
    [0, 0, 0, 0, 0, 0, 0, 0, 4.3628, -6.4787, 2.1159, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -10.8825, 15.4656, -4.6167, 0, 0, 0],
    [0, 0, 0, 0, 0, 2.2571, 0, 0, 0, 2.0630, -4.3201, 0, 0, 0, 0, 0, 0, 0, 0, -4.3067, 0, 0, 0, -4.6646, 8.9649, 0, 0, 0],
    [0, 0, 0, 0, 0, 1.7756, 0, 0, 0, 0, 0, -4.5289, 2.7533, 0, 0, 0, 0, 0, 0, -3.3264, 0, 0, 0, 0, 0, 5.7106, -2.3800, 0],
    [0, 0, 0, 0, 0, 3.5937, 0, 0, 0, 0, 0, 2.7611, -7.5528, 1.1980, 0, 0, 0, 0, 0, -6.3536, 0, 0, 0, 0, 0, -2.36046520378199, 11.1439, -2.4488],
    [0, 0, 0, 0, 0, 0, 0, 0, 1.6212, 0, 0, 0, 1.2754, -2.8966, 0, 0, 0, 0, 0, 0, 0, 0, -3.10919655548260, 0, 0, 0, -2.3799, 5.4915]
],0.01);