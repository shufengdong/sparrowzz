#include ../data/case14.txt
#include ../lib/idx_gen.txt
#include ../lib/idx_bus.txt
#include ../lib/idx_brch.txt
#include ../lib/make_y_bus.txt
#include ../lib/dsbus_dv.txt
#include ../lib/make_jac.txt
#include ../lib/bustypes.txt

// 可以同时测试dSbus_dV的计算

jac = make_jac(baseMVA, bus, branch, gen, 1);
//println(jac);

assert_relative_eq(jac, [
    [c(22.0183,0),    c(-17.3238,0), c(0,0), c(0,0),  c(-4.6945,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(8.5785,0),    c(-3.8746,0), c(0,0), c(0,0),  c(-0.3895,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(-16.3624,0),    c(32.7603,0), c(-5.1624,0), c(-5.5913,0),  c(-5.6442,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(-6.5890,0),    c(10.1258,0), c(-0.5023,0), c(-1.2558,0),  c(-1.4141,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(-4.8397,0), c(9.9667,0), c(-5.1270,0),  c(-5.6442,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(-1.7864,0), c(2.2188,0), c(-2.2176,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(-5.2565,0), c(-5.2975,0), c(40.0588,0),  c(-22.2278,0),  c(0,0),  c(-5.2839,0),  c(0,0),  c(-1.9902,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(-2.1966,0), c(-1.8066,0), c(10.2444,0),  c(-7.5632,0),  c(0,0),  c(0.2642,0),  c(0,0),  c(0.1520,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(-4.3559,0),    c(-5.4039,0), c(0,0), c(-22.6124,0),  c(36.9979,0),  c(-4.6256,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(-1.6935,0),    c(-2.0825,0), c(0,0), c(-6.3799,0),  c(9.6839,0),  c(0.4117,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(-4.6256,0),  c(19.8008,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-4.6521,0),  c(-3.6103,0),  c(-6.9126,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(-0.4319,0),  c(6.9377,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-2.0482,0),  c(-1.5822,0),  c(-3.2083,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(-5.2839,0),  c(0,0),  c(0,0),  c(22.0459,0),  c(-6.5716,0),  c(-10.1904,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(-0.2754,0),  c(0,0),  c(0,0),  c(-0.0023,0),  c(-0.0011,0),  c(0.2645,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-6.5716,0),  c(6.5716,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0.0011,0),  c(0.0011,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(-1.9902,0),  c(0,0),  c(0,0),  c(-10.1904,0),  c(0,0),  c(27.0399,0),  c(-11.5161,0),  c(0,0),  c(0,0),  c(0,0),  c(-3.3431,0),   c(0,0),    c(0,0), c(0,0), c(-0.1575,0),  c(0,0),  c(0,0),  c(-0.2630,0),  c(0,0),  c(5.3468,0),  c(-4.0900,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.4421,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-11.4920,0),  c(16.3718,0),  c(-4.8799,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-4.1315,0),  c(5.9914,0),  c(-2.0018,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-4.6081,0),  c(0,0),  c(0,0),  c(0,0),  c(-4.9025,0),  c(9.5106,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-2.1094,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.9629,0),  c(4.0220,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-3.5592,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(6.0582,0),  c(-2.4990,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-1.6594,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(4.1789,0),  c(-2.6222,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-6.7984,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-2.4903,0),  c(11.8256,0),  c(-2.5369,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(-3.3586,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-2.6172,0),  c(6.9293,0),  c(-1.1564,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-3.2833,0),  c(0,0),  c(0,0),  c(0,0),  c(-2.4989,0),  c(5.7822,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.5352,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.2146,0),  c(2.5105,0)  ],
    [c(-4.4463,0),    c(4.0490,0), c(0,0), c(0,0),  c(0.3973,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(20.4558,0),    c(-16.5778,0), c(0,0), c(0,0),  c(0,0),  c(-4.6025,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(6.9843,0),    c(-10.2136,0), c(0.5073,0), c(1.2796,0),  c(1.4424,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(-15.4362,0),    c(31.9192,0), c(-5.1113,0), c(-5.4870,0),  c(-5.5335,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(1.8668,0), c(-4.1265,0), c(2.2597,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(-4.6313,0), c(9.9732,0), c(-5.0314,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(2.2955,0), c(1.8246,0), c(-11.3935,0),  c(7.7144,0),  c(0,0),  c(-0.2806,0),  c(0,0),  c(-0.1605,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(-5.0301,0), c(-5.2450,0), c(39.4683,0),  c(-21.7919,0),  c(0,0),  c(-4.9754,0),  c(0,0),  c(-1.8846,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(1.7951,0),    c(2.1762,0), c(0,0), c(6.5011,0),  c(-10.0319,0),  c(-0.4405,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(-4.1093,0),    c(-2.1712,0), c(0,0), c(-22.1908,0),  c(36.2162,0),  c(-4.3230,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0.4405,0),  c(-7.6434,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(1.6692,0),  c(3.3687,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(-4.5349,0),  c(18.6038,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-4.4013,0),  c(-3.4221,0),  c(-6.5835,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0.2806,0),  c(0,0),  c(0,0),  c(-0.0025,0),  c(0.0011,0),  c(-0.2793,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(-5.1854,0),  c(0,0),  c(0,0),  c(20.7633,0),  c(-6.0290,0),  c(-9.6500,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-0.0011,0),  c(0.0011,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-6.1879,0),  c(6.3469,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0.1605,0),  c(0,0),  c(0,0),  c(0.2793,0),  c(0,0),  c(-6.2323,0),  c(4.2986,0),  c(0,0),  c(0,0),  c(0,0),  c(1.4940,0),   c(0,0),    c(0,0), c(0,0), c(-1.9631,0),  c(0,0),  c(0,0),  c(-9.5955,0),  c(0,0),  c(25.2774,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-3.2270,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(4.3628,0),  c(-6.4787,0),  c(2.1159,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-10.8825,0),  c(0,0),  c(-4.6167,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(2.2571,0),  c(0,0),  c(0,0),  c(0,0),  c(2.0630,0),  c(-4.3201,0),  c(0,0),  c(0,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-4.3067,0),  c(0,0),  c(0,0),  c(0,0),  c(8.9649,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(1.7756,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-4.5289,0),  c(2.7533,0),  c(0,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-3.3264,0),  c(0,0),  c(0,0),  c(-10.9573,0),  c(0,0),  c(5.7106,0),  c(-2.3800,0),  c(0,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(3.5937,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(2.7611,0),  c(-7.5528,0),  c(1.1980,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(-3.3536,0),  c(0,0),  c(0,0),  c(15.4657,0),  c(0,0),  c(-2.3605,0),  c(11.1439,0),  c(-2.4488,0)  ],
    [c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(1.6212,0),  c(0,0),  c(0,0),  c(0,0),  c(1.2754,0),  c(-2.8966,0),   c(0,0),    c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-3.1092,0),  c(-4.6646,0),  c(0,0),  c(0,0),  c(-2.3799,0),  c(5.4915,0)  ]
],4);

return jac;
