#include ../data/case14.txt
#include ../lib/idx_gen.txt
#include ../lib/idx_bus.txt
#include ../lib/idx_brch.txt
#include ../lib/make_y_bus.txt

[ybus, yf, yt] = make_y_bus(baseMVA, bus, branch);

assert_relative_eq(ybus, [
    [c(6.02502905576822, -19.4470702055144), c(-4.99913160079804, 15.2630865231796), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.02589745497019, 4.23498368233483), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(-4.99913160079804, 15.2630865231796), c(9.52132361081478, -30.2721153987791), c(-1.13501919230740, 4.78186315175772), c(-1.68603315061494, 5.11583832587208), c(-1.70113966709440, 5.19392739796971), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(-1.13501919230740, 4.78186315175772), c(3.12099490223296, -9.82238012935164), c(-1.98597570992556, 5.06881697759392), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(-1.68603315061494, 5.11583832587208), c(-1.98597570992556, 5.06881697759392), c(10.5129895220362, -38.6541712076078), c(-6.84098066149567, 21.5785539816916), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 4.88951266031734), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 1.85549955781590), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(-1.02589745497019, 4.23498368233483), c(-1.70113966709440, 5.19392739796971), c(0.00000000000000, 0.00000000000000), c(-6.84098066149567, 21.5785539816916), c(9.56801778356026, -35.5336394560448), c(0.00000000000000, 4.25744533525338), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 4.25744533525338), c(6.57992340746622, -17.3407328099191), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.95502856317726, 4.09407434424044), c(-1.52596744045097, 3.17596396502940), c(-3.09892740383799, 6.10275544819312), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 4.88951266031734), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, -19.5490059482647), c(0.00000000000000, 5.67697984672154), c(0.00000000000000, 9.09008271975275), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 5.67697984672154), c(0.00000000000000, -5.67697984672154), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 1.85549955781590), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 9.09008271975275), c(0.00000000000000, 0.00000000000000), c(5.32605503946736, -24.0925063752679), c(-3.90204955244743, 10.3653941270609), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.42400548701993, 3.02905045693060)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-3.90204955244743, 10.3653941270609), c(5.78293430614783, -14.7683378765214), c(-1.88088475370040, 4.40294374946052), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.95502856317726, 4.09407434424044), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.88088475370040, 4.40294374946052), c(3.83591331687766, -8.49701809370096), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.52596744045097, 3.17596396502940), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(4.01499202727289, -5.42793859120161), c(-2.48902458682192, 2.25197462617221), c(0.00000000000000, 0.00000000000000)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-3.09892740383799, 6.10275544819312), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-2.48902458682192, 2.25197462617221), c(6.72494614846623, -10.6696935494707), c(-1.13699415780633, 2.31496347510535)],
    [c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.42400548701993, 3.02905045693060), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(0.00000000000000, 0.00000000000000), c(-1.13699415780633, 2.31496347510535), c(2.56099964482626, -5.34401393203596)]
],0.001);

assert_relative_eq(yf, [
    [c(4.9991,-15.2367), c(-4.9991,15.2631), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(1.0259,-4.2103), c(0,0), c(0,0), c(0,0.0), c(-1.0259,4.2350), c(0,0.0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.1350,-4.7600), c(-1.1350,4.7819), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.6860,-5.0988), c(0,0), c(-1.6860,5.1158), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.7011,-5.1766), c(0,0), c(0,0), c(-1.7011,5.1939), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(1.9860,-5.0624), c(-1.9860,5.0688), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(6.8410,-21.5786), c(-6.8410,21.5786), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,-4.9995), c(0,0), c(0,0), c(-0.0,4.8895), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,-1.9149), c(0,0), c(0,0), c(0,0), c(0,0), c(-0.0,1.8555), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-4.5681), c(-0.0,4.2574), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.9550,-4.0941), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.9550,4.0941), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.5260,-3.1760), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.5260,3.1760), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.0989,-6.1028), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.0989,6.1028), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-5.6770), c(-0.0,5.6770), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-9.0901), c(0,0), c(-0.0,9.0901), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.9020,-10.3653), c(-3.9020,10.3654), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.4240,-3.0290), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.4240,3.0291)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.8809,-4.4029), c(-1.8809,4.4029), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(2.4890,-2.2520), c(-2.4890,2.2520), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.1370,-2.3150), c(-1.1370,2.3150)]
],0.001);

assert_relative_eq(yt, [
    [c(-4.9991,15.2631), c(4.9991,-15.2367), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(-1.0259,4.2350), c(0,0), c(0,0), c(0,0), c(1.0259,-4.2104), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.1350,4.7819), c(1.1350,-4.7600), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.6860,5.1158), c(0,0), c(1.6860,-5.0988), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.7011,5.1939), c(0,0), c(0,0), c(1.7011,-5.1766), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(-1.9860,5.0688), c(1.9860,-5.0624), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(-6.8410,21.578553981691588), c(6.8410,-21.5786), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,4.8895), c(0,0), c(0,0), c(0.0,-4.7819), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,1.8555), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-1.7980), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,4.2574), c(0.0,-3.9679), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.9550,4.0940), c(0,0), c(0,0), c(0,0), c(0,0), c(1.9550,-4.0941), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.5260,3.1760), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.5260,-3.1760), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.0989,6.1028), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.0989,-6.1028), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,5.6770), c(0.0,-5.6770), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,9.0901), c(0,0), c(0.0,-9.0901), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.90208,10.3654), c(3.9020,-10.3654), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.4240,3.0291), c(0,0), c(0,0), c(0,0), c(0,0), c(1.4240,-3.0291)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.8809,4.4029), c(1.8809,-4.4029), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-2.4890,2.2520), c(2.4890,-2.2520), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.1370,2.3150), c(1.1370,-2.3150)]
],0.001);