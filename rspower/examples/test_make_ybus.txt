#include ../data/case14.txt
#include ../lib/idx_gen.txt
#include ../lib/idx_bus.txt
#include ../lib/idx_brch.txt
#include ../lib/make_y_bus.txt

[ybus, yf, yt] = make_y_bus(baseMVA, bus, branch);

assert_relative_eq(ybus, [
    [c(6.0250,-19.4471),    c(-4.9991,15.2631), c(0,0), c(0,0),  c(-1.0259,4.2350),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(-4.9991,15.2631),    c(9.5213,-30.2721), c(-1.1350,4.7819), c(-1.6860,5.1158),  c(-1.7011,5.1939),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(-1.1350,4.7819),  c(3.1210,-9.8224), c(-1.9860,5.0688),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(-1.6860,5.1158),  c(-1.9860,5.0688), c(10.5130,-38.6542),  c(-6.8410,21.5786),  c(0,0),  c(0,4.8895),  c(0,0),  c(0,1.8555),  0,  0,  0,  0,  0  ],
    [c(-1.0259,4.2350),     c(-1.7011,5.1939), c(0,0), c(-6.8410,21.5786),  c(9.5680,-35.5336),  c(0,4.2574),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,4.2574),  c(6.5799,-17.3407),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.9550,4.0941),  c(-1.5260,3.1760),  c(-3.0989,6.1028),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,4.8895),  c(0,0),  c(0,0),  c(0,-19.5490),  c(0,5.6770),  c(0,9.0901),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,5.6770),  c(0,-5.6770),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,1.8555),  c(0,0),  c(0,0),  c(0,9.0901),  c(0,0),  c(5.3261,-24.0925),  c(-3.9020,10.3654),  c(0,0),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-3.9020,10.3654),  c(5.7829,-14.7683),  c(-1.8809,4.4029),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(-1.9550,4.0941),  c(0,0),  c(0,0),  c(0,0),  c(-1.8809,4.4029),  c(3.8359,-8.4970),  c(0,0),  c(0,0),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(-1.5260,3.1760),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(4.0150,-5.4279),  c(-2.4890,2.2520),  c(0,0)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(-3.0989,6.1028),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-2.4890,2.2520),  c(6.7249,-10.6697),  c(-1.1370,2.3150)  ],
    [c(0,0), c(0,0), c(0,0), c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(0,0),  c(-1.4240,3.0291),  c(0,0),  c(0,0),  c(0,0),  c(-1.1370,2.3150),  c(2.5610,-5.3440)  ]
],4);

assert_relative_eq(yf, [
    [c(4.9991,-15.2367), c(-4.9991,15.2631), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(1.0259,-4.2103), c(0,0), c(0,0), c(0,0.0), c(-1.0259,4.2350), c(0,0.0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.1350,-4.7600), c(-1.1350,4.7819), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.6860,-5.0988), c(0,0), c(-1.6860,5.1158), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(1.7011,-5.1766), c(0,0), c(0,0), c(-1.7011,5.1939), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(1.9860,-5.0624), c(-1.9860,5.0688), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(6.8410,-21.5786), c(-6.8410,21.5786), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,-4.9995), c(0,0), c(0,0), c(-0.0,4.8895), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,-1.9149), c(0,0), c(0,0), c(0,0), c(0,0), c(-0.0,1.8555), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-4.5681), c(-0.0,4.2574), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.9550,-4.0941), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.9550,4.0941), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.5260,-3.1760), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.5260,3.1760), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.0989,-6.1028), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.0989,6.1028), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-5.6770), c(-0.0,5.6770), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-9.0901), c(0,0), c(-0.0,9.0901), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.9020,-10.3653), c(-3.9020,10.3654), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.4240,-3.0290), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.4240,3.0291)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.8809,-4.4029), c(-1.8809,4.4029), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(2.4890,-2.2520), c(-2.4890,2.2520), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.1370,-2.3150), c(-1.1370,2.3150)]
],4);

assert_relative_eq(yt, [
    [c(-4.9991,15.2631), c(4.9991,-15.2367), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(-1.0259,4.2350), c(0,0), c(0,0), c(0,0), c(1.0259,-4.2104), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.1350,4.7819), c(1.1350,-4.7600), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.6860,5.1158), c(0,0), c(1.6860,-5.0988), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(-1.7011,5.1939), c(0,0), c(0,0), c(1.7011,-5.1766), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(-1.9860,5.0688), c(1.9860,-5.0624), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(-6.8410,21.578553981691588), c(6.8410,-21.5786), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,4.8895), c(0,0), c(0,0), c(0.0,-4.7819), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0.0,1.8555), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,-1.7980), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,4.2574), c(0.0,-3.9679), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.9550,4.0940), c(0,0), c(0,0), c(0,0), c(0,0), c(1.9550,-4.0941), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.5260,3.1760), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(1.5260,-3.1760), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.0989,6.1028), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(3.0989,-6.1028), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,5.6770), c(0.0,-5.6770), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0.0,9.0901), c(0,0), c(0.0,-9.0901), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-3.90208,10.3654), c(3.9020,-10.3654), c(0,0), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.4240,3.0291), c(0,0), c(0,0), c(0,0), c(0,0), c(1.4240,-3.0291)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.8809,4.4029), c(1.8809,-4.4029), c(0,0), c(0,0), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-2.4890,2.2520), c(2.4890,-2.2520), c(0,0)],
    [c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(0,0), c(-1.1370,2.3150), c(1.1370,-2.3150)]
],4);